"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_stockMarketDist=require("./stock-market-dist"),_stockMarketDist2=_interopRequireDefault(_stockMarketDist),_stockDist=require("./stock-dist"),_stockDist2=_interopRequireDefault(_stockDist),_tradeDist=require("./trade-dist"),_tradeDist2=_interopRequireDefault(_tradeDist),StockHandler=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),!t.stockMarket)throw new Error("Must provide a stockMarket");this.options=t,this.stockMarket=t.stockMarket}return _createClass(e,[{key:"getDividendYield",value:function(e,t){var r=0;return"common"===e.type?r=e.lastDividend/t:"preferred"===e.type&&(r=e.fixedDividend*e.parValue/t),r}},{key:"getPeRatio",value:function(e,t){var r=0,n=this.getDividendYield(e,t);return 0!==n&&(r=t/n),r}},{key:"recordTrade",value:function(e,t,r,n){this.stockMarket.trades.push(new _tradeDist2.default(e,t,r,n))}},{key:"getLatestTrades",value:function(e){var t=new Date,r=new Date(t-6e4*e);return this.stockMarket.trades.filter(function(e){return e.timestamp>=r})}},{key:"getVolumeWeightedStockPriceFor",value:function(e){var t=this.getLatestTrades(5).filter(function(t){return t.stock.symbol===e.symbol}),r=t.map(function(e){return e.price*e.qty}).reduce(function(e,t){return e+t},0),n=t.map(function(e){return e.qty}).reduce(function(e,t){return e+t},0);return 0==t.length?0:r/n}},{key:"getAllShareIndex",value:function(){for(var e=this.stockMarket.stocksCount(),t=[],r=0;r<e;r++){var n=this.stockMarket.stocks[r];t.push(this.getVolumeWeightedStockPriceFor(n))}var i=t.reduce(function(e,t){return e*t},1);return 0==e?0:Math.exp(Math.log(i)/e)}}]),e}();exports.default=StockHandler;